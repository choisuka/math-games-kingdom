<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>ìˆ˜í•™ ì™•êµ­ â€” ì •ìˆ˜ Â· ìœ ë¦¬ìˆ˜ | ì˜í†µìˆ˜í•™ì—¬í–‰í•™ì›</title>
<!-- PWA -->
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#7c3aed">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="ìˆ˜í•™ì™•êµ­">
<link rel="apple-touch-icon" href="./icon.svg">
<!-- SEO -->
<meta name="description" content="ì˜í†µìˆ˜í•™ì—¬í–‰í•™ì›ì˜ ì¬ë¯¸ìˆëŠ” ìˆ˜í•™ í•™ìŠµ ê²Œì„! ì •ìˆ˜, ì†Œìˆ˜, ë¶„ìˆ˜ë¥¼ ê²Œì„ìœ¼ë¡œ ë§ˆìŠ¤í„°í•˜ì„¸ìš”.">
<meta name="keywords" content="ìˆ˜í•™ê²Œì„, ì˜í†µìˆ˜í•™í•™ì›, ìˆ˜í•™ì—¬í–‰í•™ì›, ì •ìˆ˜, ìœ ë¦¬ìˆ˜, ìˆ˜í•™í•™ìŠµ">
<meta property="og:title" content="ìˆ˜í•™ ì™•êµ­ | ì˜í†µìˆ˜í•™ì—¬í–‰í•™ì›">
<meta property="og:description" content="ì¬ë¯¸ìˆëŠ” ìˆ˜í•™ í•™ìŠµ ê²Œì„ìœ¼ë¡œ ì‹¤ë ¥ì„ í‚¤ì›Œë³´ì„¸ìš”!">
<meta property="og:type" content="website">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:"Segoe UI","Noto Sans KR",sans-serif;
  background:linear-gradient(135deg,#0f0c29 0%,#302b63 60%,#24243e 100%);
  min-height:100vh;display:flex;justify-content:center;align-items:flex-start;padding:12px}
.wrap{width:100%;max-width:540px;margin:0 auto}

/* â”€â”€ í™”ë©´ ì „í™˜ â”€â”€ */
.screen{display:none;animation:fadeIn .25s ease}
.screen.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

/* â”€â”€ ì¹´ë“œ â”€â”€ */
.card{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);
  border-radius:20px;padding:1.5rem;margin-bottom:.85rem;backdrop-filter:blur(10px)}

/* â”€â”€ íƒ€ì´í‹€ â”€â”€ */
.title{text-align:center;padding:1.5rem 0 1rem}
.title h1{font-size:2.2rem;font-weight:900;
  background:linear-gradient(135deg,#a78bfa,#f472b6,#fb923c);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  letter-spacing:-.02em}
.title p{color:#94a3b8;font-size:.95rem;margin-top:.4rem}

/* â”€â”€ ì„¹ì…˜ ë ˆì´ë¸” â”€â”€ */
.sec-label{font-size:.72rem;font-weight:700;color:#7c8db0;letter-spacing:.1em;
  text-transform:uppercase;margin-bottom:.5rem}

/* â”€â”€ ëª¨ë“œ/ë‚œì´ë„ ë²„íŠ¼ â”€â”€ */
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:.6rem}
.grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:.6rem}
.sel-btn{border:2px solid rgba(255,255,255,.15);border-radius:13px;
  background:rgba(255,255,255,.05);color:#ccc;padding:.75rem .5rem;
  font-family:inherit;font-size:.88rem;font-weight:600;cursor:pointer;
  text-align:center;transition:all .18s;line-height:1.5}
.sel-btn:hover{border-color:#a78bfa;background:rgba(167,139,250,.15);color:#fff}
.sel-btn.active{border-color:#a78bfa;background:rgba(167,139,250,.25);color:#fff;
  box-shadow:0 0 16px rgba(167,139,250,.3)}
.sel-btn .icon{font-size:1.6rem;display:block;margin-bottom:.25rem}
.sel-btn .sub{font-size:.72rem;color:#94a3b8;margin-top:.15rem}

/* â”€â”€ ê°œë… ë¯¸ë¦¬ë³´ê¸° â”€â”€ */
.concept-preview{display:none;margin-top:.75rem}
.concept-preview.show{display:block;animation:fadeIn .2s ease}
.concept-box{
  background:rgba(251,146,60,.08);border:2px solid rgba(251,146,60,.3);
  border-radius:16px;padding:1.25rem 1.3rem;
  animation:borderGlow 2.5s ease-in-out infinite}
@keyframes borderGlow{
  0%,100%{border-color:rgba(251,146,60,.3);box-shadow:none}
  50%{border-color:rgba(251,146,60,.85);box-shadow:0 0 28px rgba(251,146,60,.35)}}
.concept-box h4{color:#fb923c;font-size:.95rem;font-weight:800;margin-bottom:.65rem}
.concept-box .rule{font-size:.84rem;color:#cbd5e1;line-height:2;margin-bottom:.65rem}
.concept-box .example{
  background:rgba(167,139,250,.12);border:1px solid rgba(167,139,250,.3);
  border-radius:10px;padding:.75rem .9rem;
  font-size:.85rem;color:#c4b5fd;font-family:monospace;line-height:1.9;
  animation:exampleFloat 3s ease-in-out infinite}
@keyframes exampleFloat{
  0%,100%{transform:translateY(0);box-shadow:none}
  50%{transform:translateY(-4px);box-shadow:0 10px 24px rgba(167,139,250,.25)}}

/* â”€â”€ ì‹œì‘ ë²„íŠ¼ â”€â”€ */
.start-btn{width:100%;padding:1rem;border:none;border-radius:14px;
  background:linear-gradient(135deg,#7c3aed,#db2777);color:#fff;
  font-size:1.1rem;font-weight:700;cursor:pointer;font-family:inherit;
  box-shadow:0 4px 24px rgba(124,58,237,.4);transition:all .2s;margin-top:.5rem}
.start-btn:hover{transform:translateY(-2px);box-shadow:0 8px 32px rgba(124,58,237,.55)}
.start-btn:disabled{background:#444;box-shadow:none;cursor:not-allowed;transform:none}

/* â”€â”€ ê²Œì„ í—¤ë” â”€â”€ */
.game-header{display:flex;align-items:center;gap:.6rem;margin-bottom:.7rem}
.prog-wrap{flex:1}
.prog-bar{height:8px;background:rgba(255,255,255,.1);border-radius:999px;overflow:hidden}
.prog-fill{height:100%;background:linear-gradient(90deg,#7c3aed,#a78bfa);
  border-radius:999px;transition:width .4s ease}
.prog-label{font-size:.75rem;color:#94a3b8;margin-bottom:.3rem}
.score-badge{background:linear-gradient(135deg,#f59e0b,#fcd34d);
  color:#78350f;padding:.3rem .8rem;border-radius:20px;font-weight:800;
  font-size:.9rem;white-space:nowrap;min-width:80px;text-align:center}
.streak-badge{background:rgba(251,146,60,.2);border:1px solid rgba(251,146,60,.4);
  color:#fb923c;padding:.3rem .65rem;border-radius:20px;font-weight:700;
  font-size:.85rem;white-space:nowrap;display:none}
.streak-badge.show{display:block}

/* â”€â”€ íŒ ì¹´ë“œ â”€â”€ */
.tip-card{background:rgba(59,130,246,.12);border:1px solid rgba(59,130,246,.3);
  border-radius:14px;padding:.75rem 1rem;margin-bottom:.75rem;
  font-size:.82rem;color:#93c5fd;line-height:1.7;
  animation:tipFloat 3s ease-in-out infinite}
.tip-card strong{color:#60a5fa}
@keyframes tipFloat{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-4px);box-shadow:0 8px 20px rgba(59,130,246,.2)}}

/* â”€â”€ íƒ€ì´ë¨¸ â”€â”€ */
.timer-row{display:flex;align-items:center;gap:.5rem;margin-bottom:.85rem}
.timer-bar{flex:1;height:10px;background:rgba(255,255,255,.1);border-radius:999px;overflow:hidden}
.timer-fill{height:100%;border-radius:999px;transition:width 1s linear,background .4s;
  background:linear-gradient(90deg,#22c55e,#86efac)}
.timer-fill.warn{background:linear-gradient(90deg,#f59e0b,#fcd34d)}
.timer-fill.danger{background:linear-gradient(90deg,#ef4444,#fca5a5)}
.timer-num{font-size:.85rem;font-weight:700;color:#94a3b8;min-width:2em;text-align:right}

/* â”€â”€ ë¬¸ì œ ë°•ìŠ¤ (ëŒ€í˜•, ê·¹ì ) â”€â”€ */
.prob-card{
  background:linear-gradient(160deg,#0a0025 0%,#160045 55%,#060015 100%);
  border:2.5px solid rgba(167,139,250,.45);
  border-radius:26px;padding:2.4rem 1.5rem 1.6rem;text-align:center;
  margin-bottom:.85rem;min-height:180px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:.9rem;
  box-shadow:0 0 50px rgba(124,58,237,.35),0 0 100px rgba(124,58,237,.15),
             inset 0 0 40px rgba(124,58,237,.05);
  animation:probGlow 2.8s ease-in-out infinite;position:relative}
@keyframes probGlow{
  0%,100%{border-color:rgba(167,139,250,.45);box-shadow:0 0 50px rgba(124,58,237,.35),0 0 100px rgba(124,58,237,.15)}
  50%{border-color:rgba(167,139,250,.9);box-shadow:0 0 80px rgba(124,58,237,.6),0 0 160px rgba(124,58,237,.3)}}
.prob-label{font-size:.78rem;font-weight:800;color:#a78bfa;
  letter-spacing:.14em;text-transform:uppercase;
  text-shadow:0 0 10px rgba(167,139,250,.5)}
.prob-expr{font-size:3rem;font-weight:900;color:#fff;
  display:flex;align-items:center;justify-content:center;flex-wrap:wrap;
  gap:.3rem;line-height:2.2;
  text-shadow:0 0 24px rgba(167,139,250,.55)}

/* â”€â”€ íŒíŠ¸ ë²„íŠ¼ â”€â”€ */
.hint-btn{
  border:2px solid rgba(251,191,36,.55);border-radius:24px;
  background:rgba(251,191,36,.1);color:#fbbf24;
  padding:.45rem 1.1rem;font-family:inherit;font-size:.9rem;font-weight:800;
  cursor:pointer;transition:all .2s;letter-spacing:.03em;
  animation:hintGlow 2s ease-in-out infinite}
.hint-btn:hover{background:rgba(251,191,36,.22);transform:scale(1.06);
  box-shadow:0 0 20px rgba(251,191,36,.5)}
@keyframes hintGlow{
  0%,100%{box-shadow:0 0 0 rgba(251,191,36,0)}
  50%{box-shadow:0 0 18px rgba(251,191,36,.5)}}

/* â•â• íŒíŠ¸ ëª¨ë‹¬ â•â• */
.hint-overlay{
  display:none;position:fixed;inset:0;z-index:350;
  background:rgba(0,0,0,.78);backdrop-filter:blur(8px);
  align-items:center;justify-content:center;padding:1rem}
.hint-overlay.show{display:flex;animation:overlayIn .2s ease}
.hint-modal{
  width:100%;max-width:480px;
  background:linear-gradient(155deg,#1a1500 0%,#2a2000 55%,#120e00 100%);
  border:2.5px solid #f59e0b;border-radius:26px;padding:2rem 1.7rem 1.7rem;
  box-shadow:0 0 55px rgba(245,158,11,.5),0 0 110px rgba(245,158,11,.2);
  animation:modalPop .4s cubic-bezier(.34,1.56,.64,1)}
.hint-title{text-align:center;font-size:2rem;font-weight:900;color:#fbbf24;
  margin-bottom:1.2rem;letter-spacing:.04em;
  text-shadow:0 0 24px rgba(251,191,36,.9);
  animation:wrongPulse 1.4s ease-in-out infinite}
.hint-tip{
  background:rgba(245,158,11,.1);border:1px solid rgba(245,158,11,.25);
  border-radius:14px;padding:.85rem 1rem;
  font-size:.9rem;color:#fde68a;line-height:1.8;
  margin-bottom:1rem;text-align:center}
.hint-rules{list-style:none;display:flex;flex-direction:column;gap:.6rem;margin-bottom:1.3rem}
.hint-rules li{
  font-size:.95rem;color:#fef3c7;line-height:1.75;
  padding:.75rem 1rem;background:rgba(245,158,11,.08);
  border-radius:13px;border-left:4px solid #f59e0b;
  opacity:0;transform:translateX(-24px);animation:stepIn .4s ease forwards}
.hint-close{
  width:100%;padding:1rem;border:none;border-radius:15px;
  background:linear-gradient(135deg,#d97706,#f59e0b);
  color:#1a0a00;font-size:1.05rem;font-weight:900;
  cursor:pointer;font-family:inherit;
  box-shadow:0 4px 20px rgba(217,119,6,.4);
  animation:nextPulse 1.8s ease-in-out infinite}
.hint-close:hover{animation:none;transform:scale(1.05)}

/* â”€â”€ ë¶„ìˆ˜ í‘œì‹œ â”€â”€ */
.frac{display:inline-flex;flex-direction:column;align-items:center;
  vertical-align:middle;margin:0 3px;font-size:.88em;line-height:1.2}
.ft{border-bottom:2.5px solid currentColor;padding:0 5px 2px;min-width:1.4em;text-align:center}
.fb{padding:2px 5px 0;min-width:1.4em;text-align:center}

/* â”€â”€ ì„ íƒì§€ ë²„íŠ¼ â”€â”€ */
.ans-grid{display:grid;grid-template-columns:1fr 1fr;gap:.65rem;margin-bottom:.7rem}
.ans-btn{border:2.5px solid rgba(255,255,255,.15);border-radius:14px;
  background:rgba(255,255,255,.07);color:#fff;padding:1rem .5rem;
  font-family:inherit;font-size:1.3rem;font-weight:700;cursor:pointer;
  transition:all .15s;min-height:70px;display:flex;align-items:center;justify-content:center}
.ans-btn:hover:not(:disabled){border-color:#a78bfa;background:rgba(167,139,250,.2);
  transform:translateY(-2px);box-shadow:0 4px 16px rgba(167,139,250,.25)}
.ans-btn.correct{border-color:#22c55e !important;background:rgba(34,197,94,.2) !important;
  color:#bbf7d0 !important;animation:pulse-green .3s ease}
.ans-btn.wrong{border-color:#ef4444 !important;background:rgba(239,68,68,.2) !important;
  color:#fecaca !important;animation:shake .35s ease}
.ans-btn:disabled{cursor:default}
@keyframes pulse-green{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-8px)}75%{transform:translateX(8px)}}

/* â”€â”€ í”¼ë“œë°± â”€â”€ */
.feedback{text-align:center;font-size:.95rem;font-weight:700;min-height:1.5rem;margin-bottom:.4rem}
.feedback.ok{color:#34d399}.feedback.ng{color:#f87171}

/* â”€â”€ íŒŒí‹°í´ â”€â”€ */
.particle{position:fixed;pointer-events:none;font-size:1.5rem;
  animation:floatUp .8s ease forwards;z-index:999}
@keyframes floatUp{0%{transform:translateY(0) scale(1);opacity:1}
  100%{transform:translateY(-120px) scale(0);opacity:0}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â˜…  FLASH OVERLAY  â˜…
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.flash-overlay{position:fixed;inset:0;pointer-events:none;z-index:500;opacity:0}
.flash-overlay.red{animation:flashRed .6s ease forwards}
.flash-overlay.orange{animation:flashOrange .6s ease forwards}
@keyframes flashRed{
  0%{background:rgba(239,68,68,0);opacity:1}
  18%{background:rgba(239,68,68,.55)}
  100%{background:rgba(239,68,68,0);opacity:0}}
@keyframes flashOrange{
  0%{background:rgba(251,146,60,0);opacity:1}
  18%{background:rgba(251,146,60,.45)}
  100%{background:rgba(251,146,60,0);opacity:0}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â˜…  í’€ì´ FULL-SCREEN OVERLAY MODAL  â˜…
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.explain-overlay{
  display:none;position:fixed;inset:0;z-index:400;
  background:rgba(0,0,0,.85);backdrop-filter:blur(10px);
  align-items:center;justify-content:center;padding:1rem;
  overflow-y:auto}
.explain-overlay.show{display:flex;animation:overlayIn .2s ease}
@keyframes overlayIn{from{opacity:0}to{opacity:1}}

.explain-modal{
  width:100%;max-width:520px;
  background:linear-gradient(160deg,#0d0022 0%,#1a004a 55%,#08001a 100%);
  border:3px solid #ef4444;border-radius:28px;
  padding:2.25rem 1.8rem 2rem;
  box-shadow:
    0 0 60px rgba(239,68,68,.6),
    0 0 130px rgba(239,68,68,.25),
    inset 0 0 60px rgba(239,68,68,.06);
  animation:modalPop .45s cubic-bezier(.34,1.56,.64,1);
  margin:auto}
@keyframes modalPop{
  from{transform:scale(0.1) rotate(-12deg);opacity:0}
  to{transform:scale(1) rotate(0deg);opacity:1}}

/* â”€â”€ í‹€ë ¸ì–´ìš” ë°°ë„ˆ â”€â”€ */
.wrong-banner{text-align:center;margin-bottom:1.6rem}
.wrong-x{
  display:block;font-size:5.5rem;line-height:1.1;
  filter:drop-shadow(0 0 24px rgba(239,68,68,1));
  animation:wrongBounceIn .55s cubic-bezier(.34,1.56,.64,1) both,
             wrongWobble 2.2s ease-in-out .6s infinite}
@keyframes wrongBounceIn{
  0%{transform:scale(0) rotate(-25deg);opacity:0}
  65%{transform:scale(1.25) rotate(6deg)}
  100%{transform:scale(1) rotate(0deg);opacity:1}}
@keyframes wrongWobble{
  0%,100%{transform:rotate(0deg) scale(1)}
  25%{transform:rotate(-10deg) scale(1.08)}
  75%{transform:rotate(10deg) scale(1.08)}}
.wrong-title{
  display:block;font-size:2.8rem;font-weight:900;letter-spacing:-.03em;
  color:#ef4444;
  text-shadow:0 0 30px rgba(239,68,68,1),0 0 80px rgba(239,68,68,.5);
  animation:wrongSlideIn .4s ease .25s both,
             wrongPulse 1.3s ease-in-out .8s infinite}
@keyframes wrongSlideIn{
  from{transform:translateX(-40px);opacity:0}
  to{transform:translateX(0);opacity:1}}
@keyframes wrongPulse{
  0%,100%{transform:scale(1);text-shadow:0 0 30px rgba(239,68,68,1),0 0 80px rgba(239,68,68,.5)}
  50%{transform:scale(1.07);text-shadow:0 0 50px rgba(239,68,68,1),0 0 140px rgba(239,68,68,.7)}}

/* â”€â”€ í’€ì´ ë¶€ì œëª© â”€â”€ */
.explain-subtitle{
  text-align:center;font-size:1.15rem;font-weight:800;
  color:#a78bfa;margin-bottom:1.3rem;letter-spacing:.06em;
  text-shadow:0 0 16px rgba(167,139,250,.5);
  animation:subtitleGlow 2s ease-in-out infinite}
@keyframes subtitleGlow{
  0%,100%{text-shadow:0 0 16px rgba(167,139,250,.5)}
  50%{text-shadow:0 0 32px rgba(167,139,250,1)}}

/* â”€â”€ í’€ì´ ë‹¨ê³„ â”€â”€ */
.explain-steps{list-style:none;display:flex;flex-direction:column;gap:.8rem;margin-bottom:1.6rem}
.explain-steps li{
  font-size:1.05rem;color:#e2e8f0;line-height:1.8;
  padding:.9rem 1.15rem;
  background:rgba(255,255,255,.07);border-radius:16px;
  border-left:5px solid #7c3aed;
  opacity:0;transform:translateX(-40px);
  animation:stepIn .45s ease forwards}
@keyframes stepIn{to{opacity:1;transform:translateX(0)}}
.explain-steps .step-num{font-weight:700;color:#a78bfa;margin-right:.35rem}

/* â”€â”€ ë§ˆì§€ë§‰ ì •ë‹µ ë‹¨ê³„ (highlight) â”€â”€ */
.explain-steps li.highlight{
  background:linear-gradient(135deg,rgba(245,158,11,.2),rgba(239,68,68,.12));
  border-left-color:#f59e0b;border-left-width:7px;
  font-size:1.25rem;font-weight:800;color:#fff;padding:1.1rem 1.15rem;
  animation:stepIn .45s ease forwards,
             finalPulse 1.1s ease-in-out infinite}
@keyframes finalPulse{
  0%,100%{box-shadow:0 0 0 rgba(245,158,11,0);transform:scale(1)}
  50%{box-shadow:0 0 36px rgba(245,158,11,.55);transform:scale(1.03)}}
.explain-steps .step-num.final{color:#f59e0b;font-size:1.3em}

/* â˜…â˜…â˜… ê°•ì¡° í…ìŠ¤íŠ¸(strong) â€” ëŠì„ì—†ì´ í™•ëŒ€/ì¶•ì†Œ â˜…â˜…â˜… */
.explain-steps strong{
  display:inline-block;
  color:#fbbf24;font-size:1.15em;
  text-shadow:0 0 14px rgba(251,191,36,.8);
  animation:pulseKey .85s ease-in-out infinite}
@keyframes pulseKey{
  0%,100%{transform:scale(1)}
  50%{transform:scale(1.35);text-shadow:0 0 28px rgba(251,191,36,1)}}

/* â”€â”€ ë‹¤ìŒ ë¬¸ì œ ë²„íŠ¼ â”€â”€ */
.next-btn{
  width:100%;padding:1.2rem;border:none;border-radius:18px;
  background:linear-gradient(135deg,#7c3aed,#db2777);color:#fff;
  font-size:1.2rem;font-weight:900;cursor:pointer;font-family:inherit;
  letter-spacing:.04em;
  box-shadow:0 4px 28px rgba(124,58,237,.55);
  animation:nextPulse 1.7s ease-in-out infinite}
@keyframes nextPulse{
  0%,100%{transform:scale(1);box-shadow:0 4px 28px rgba(124,58,237,.55)}
  50%{transform:scale(1.05);box-shadow:0 10px 50px rgba(219,39,119,.8)}}
.next-btn:hover{animation:none;transform:scale(1.08) !important;
  box-shadow:0 12px 56px rgba(219,39,119,.9) !important}

/* â”€â”€ ê²°ê³¼ â”€â”€ */
.result-score{text-align:center;padding:1.5rem;background:linear-gradient(135deg,#7c3aed,#db2777);
  border-radius:20px;margin-bottom:1rem}
.result-score .num{font-size:4rem;font-weight:900;color:#fff;line-height:1}
.result-score .lbl{font-size:.9rem;color:rgba(255,255,255,.75);margin-top:.3rem}
.result-stats{display:flex;gap:.6rem;margin-bottom:1rem}
.result-stats .stat{flex:1;background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.12);
  border-radius:14px;padding:.9rem;text-align:center}
.result-stats .stat .v{font-size:1.6rem;font-weight:800;color:#a78bfa}
.result-stats .stat .k{font-size:.75rem;color:#64748b;margin-top:.2rem}
.result-msg{text-align:center;font-size:1.05rem;font-weight:600;color:#e2e8f0;margin-bottom:1rem}
.result-btns{display:flex;gap:.6rem}
.result-btns button{flex:1;padding:.9rem;border-radius:13px;border:2px solid;
  font-family:inherit;font-size:.95rem;font-weight:700;cursor:pointer;transition:all .2s}
.result-btns .btn-main{background:transparent;color:#a78bfa;border-color:#a78bfa}
.result-btns .btn-retry{background:linear-gradient(135deg,#7c3aed,#db2777);color:#fff;border-color:transparent}
.result-btns button:hover{transform:translateY(-2px)}

/* â”€â”€ ì˜¤ë‹µ ë…¸íŠ¸ â”€â”€ */
.mistake-list{display:flex;flex-direction:column;gap:.5rem;margin-bottom:1rem;max-height:250px;overflow-y:auto}
.mistake-item{background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.2);
  border-radius:12px;padding:.75rem 1rem;font-size:.83rem;color:#cbd5e1}
.mistake-item .mq{font-weight:700;color:#fca5a5;margin-bottom:.2rem}
.mistake-item .ma{color:#94a3b8}
</style>
</head>
<body>

<!-- â•â• í™”ë©´ í”Œë˜ì‹œ â•â• -->
<div id="flash-overlay" class="flash-overlay"></div>

<!-- â•â• íŒíŠ¸ ëª¨ë‹¬ â•â• -->
<div id="hint-overlay" class="hint-overlay">
  <div class="hint-modal">
    <div class="hint-title">ğŸ’¡ íŒíŠ¸</div>
    <div class="hint-tip" id="hint-tip"></div>
    <ul class="hint-rules" id="hint-rules"></ul>
    <button class="hint-close" onclick="closeHint()">âœ… ì•Œê² ì–´ìš”! ë‹«ê¸°</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     â˜…  í’€ì´ ì „ì²´í™”ë©´ ëª¨ë‹¬  â˜…
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="explain-overlay" class="explain-overlay">
  <div class="explain-modal">
    <div class="wrong-banner">
      <span class="wrong-x" id="wrong-x">âŒ</span>
      <span class="wrong-title" id="wrong-title-text">í‹€ë ¸ì–´ìš”!</span>
    </div>
    <div class="explain-subtitle">ğŸ“š ì´ë ‡ê²Œ í’€ì–´ìš”!</div>
    <ol class="explain-steps" id="explain-steps"></ol>
    <button class="next-btn" onclick="nextQ()">ë‹¤ìŒ ë¬¸ì œ â†’</button>
  </div>
</div>

<div class="wrap">

<!-- â•â• ë©”ë‰´ â•â• -->
<div id="scr-menu" class="screen active">
  <div class="title">
    <h1>ìˆ˜í•™ ì™•êµ­ ğŸ®</h1>
    <p>ì •ìˆ˜ì™€ ìœ ë¦¬ìˆ˜ â€” ê°œë… í•™ìŠµ + ê²Œì„</p>
  </div>

  <div class="card">
    <div class="sec-label">ğŸ“š í•™ìŠµ ìœ í˜•</div>
    <div class="grid2" style="margin-bottom:.85rem">
      <button class="sel-btn" id="btn-int" onclick="pickMode('int')">
        <span class="icon">ğŸ”¢</span>ì •ìˆ˜ ì—°ì‚°<div class="sub">+  âˆ’  Ã—  Ã·  ìŒìˆ˜ í¬í•¨</div>
      </button>
      <button class="sel-btn" id="btn-rat" onclick="pickMode('rat')">
        <span class="icon">ğŸ”£</span>ìœ ë¦¬ìˆ˜ ì—°ì‚°<div class="sub">ë¶„ìˆ˜ +  âˆ’  Ã—  Ã·</div>
      </button>
    </div>

    <div class="sec-label">âš¡ ë‚œì´ë„</div>
    <div class="grid3" style="margin-bottom:.85rem">
      <button class="sel-btn" id="btn-easy"   onclick="pickDiff('easy')"><span class="icon">ğŸ˜Š</span>ì‰¬ì›€</button>
      <button class="sel-btn" id="btn-medium" onclick="pickDiff('medium')"><span class="icon">ğŸ¤”</span>ë³´í†µ</button>
      <button class="sel-btn" id="btn-hard"   onclick="pickDiff('hard')"><span class="icon">ğŸ”¥</span>ì–´ë ¤ì›€</button>
    </div>

    <div class="concept-preview" id="concept-preview">
      <div class="concept-box" id="concept-box"></div>
    </div>

    <button class="start-btn" id="start-btn" onclick="startGame()" disabled>ğŸš€ ê²Œì„ ì‹œì‘!</button>
  </div>

  <!-- ë‹¤ë¥¸ ê²Œì„ -->
  <div class="card" style="margin-top:.75rem;padding:1rem 1.2rem">
    <div class="sec-label" style="margin-bottom:.6rem">ğŸ“ ì˜í†µìˆ˜í•™ì—¬í–‰í•™ì› â€” ë‹¤ë¥¸ ê²Œì„</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:.6rem">
      <a href="/games/algebra" target="_blank"
        style="display:block;background:linear-gradient(135deg,#1e1050,#2a1a6e);
        border:1.5px solid rgba(167,139,250,.35);border-radius:14px;padding:.85rem .7rem;
        text-decoration:none;text-align:center;transition:.2s;"
        onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform=''">
        <div style="font-size:1.5rem;margin-bottom:.25rem">ğŸ”®</div>
        <div style="font-size:.8rem;font-weight:700;color:#a78bfa">ë¬¸ìì™€ ì‹<br>ë§ˆë²•í•™êµ</div>
        <div style="font-size:.65rem;color:#64748b;margin-top:.2rem">ì¤‘1 ë¬¸ìì™€ ì‹</div>
      </a>
      <a href="/games/detective" target="_blank"
        style="display:block;background:linear-gradient(135deg,#1a1000,#2a1800);
        border:1.5px solid rgba(212,160,23,.35);border-radius:14px;padding:.85rem .7rem;
        text-decoration:none;text-align:center;transition:.2s;"
        onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform=''">
        <div style="font-size:1.5rem;margin-bottom:.25rem">ğŸ”</div>
        <div style="font-size:.8rem;font-weight:700;color:#d4a017">ìˆ˜í•™ íƒì •<br>ìˆ˜ì‚¬êµ­</div>
        <div style="font-size:.65rem;color:#64748b;margin-top:.2rem">ë°©ì •ì‹ í™œìš©</div>
      </a>
    </div>
  </div>
</div>

<!-- â•â• ê²Œì„ â•â• -->
<div id="scr-game" class="screen">
  <div class="game-header">
    <div class="prog-wrap">
      <div class="prog-label" id="prog-label">1 / 10</div>
      <div class="prog-bar"><div class="prog-fill" id="prog-fill" style="width:0%"></div></div>
    </div>
    <div class="score-badge" id="score-badge">â­ 0</div>
    <div class="streak-badge" id="streak-badge">ğŸ”¥ 0</div>
  </div>

  <div class="tip-card" id="tip-card"></div>

  <div class="timer-row">
    <div class="timer-bar"><div class="timer-fill" id="timer-fill" style="width:100%"></div></div>
    <div class="timer-num" id="timer-num">30</div>
  </div>

  <div class="prob-card">
    <div class="prob-label">ë¬¸ì œ</div>
    <div class="prob-expr" id="prob-expr"></div>
    <button class="hint-btn" id="hint-btn" onclick="showHint()">ğŸ’¡ íŒíŠ¸ ë³´ê¸°</button>
  </div>

  <div class="ans-grid" id="ans-grid"></div>
  <div class="feedback" id="feedback"></div>
</div>

<!-- â•â• ê²°ê³¼ â•â• -->
<div id="scr-result" class="screen">
  <div class="title" style="padding-top:.5rem">
    <h1 id="res-emoji" style="font-size:3rem"></h1>
  </div>
  <div class="result-score">
    <div class="num" id="res-score">0</div>
    <div class="lbl">ì  / 100ì </div>
  </div>
  <div class="result-msg" id="res-msg"></div>
  <div class="result-stats">
    <div class="stat"><div class="v" id="res-correct">0</div><div class="k">ì •ë‹µ âœ…</div></div>
    <div class="stat"><div class="v" id="res-wrong">0</div><div class="k">ì˜¤ë‹µ âŒ</div></div>
    <div class="stat"><div class="v" id="res-acc">0%</div><div class="k">ì •í™•ë„</div></div>
  </div>

  <div id="mistake-section" style="display:none">
    <div class="card" style="padding:1rem">
      <div class="sec-label" style="color:#f87171;margin-bottom:.6rem">âŒ ì˜¤ë‹µ ë…¸íŠ¸</div>
      <div class="mistake-list" id="mistake-list"></div>
    </div>
  </div>

  <div class="result-btns">
    <button class="btn-main" onclick="goMenu()">ğŸ  ë©”ì¸</button>
    <button class="btn-retry" onclick="retryGame()">ğŸ”„ ë‹¤ì‹œ í•˜ê¸°</button>
  </div>
</div>

</div><!-- /.wrap -->

<script>
// â”€â”€ ìƒíƒœ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const S = { mode:null, diff:null, qs:[], cur:0, score:0,
            correct:0, wrong:0, streak:0, tLeft:30,
            timerID:null, answered:false, mistakes:[] };

// â”€â”€ ìœ í‹¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ri  = (lo,hi) => Math.floor(Math.random()*(hi-lo+1))+lo;
const rnz = (lo,hi) => { let v; do{v=ri(lo,hi);}while(v===0); return v; };
const gcd = (a,b)   => { a=Math.abs(a);b=Math.abs(b);while(b){[a,b]=[b,a%b];}return a||1; };
const simp= (n,d)   => { if(d<0){n=-n;d=-d;}const g=gcd(Math.abs(n),d);return{n:n/g,d:d/g}; };
const fs  = f       => f.d===1?String(f.n):`${f.n}/${f.d}`;
const wrap= v       => v<0?`(${v})`:String(v);

function fh(n,d){
  if(d===1) return `<strong>${n}</strong>`;
  return `<span class="frac"><span class="ft">${n}</span><span class="fb">${d}</span></span>`;
}
function lcm(a,b){ return a*b/gcd(a,b); }

// â”€â”€ ê°œë… ì •ë³´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CONCEPTS = {
  int_easy:{
    title:'ì •ìˆ˜ì˜ ë§ì…ˆ Â· ëº„ì…ˆ',
    rules:[
      '(+) + (+) â†’ ì ˆëŒ“ê°’ì˜ í•©, ì–‘ìˆ˜(+)',
      '(âˆ’) + (âˆ’) â†’ ì ˆëŒ“ê°’ì˜ í•©, ìŒìˆ˜(âˆ’)',
      'ë¶€í˜¸ê°€ ë‹¤ë¥¼ ë•Œ â†’ ì ˆëŒ“ê°’ì˜ ì°¨, í° ìª½ ë¶€í˜¸',
      'ëº„ì…ˆ: a âˆ’ b = a + (âˆ’b) ë¡œ ë³€í™˜'
    ],
    ex:'(-3) + 8 = ?  â†’  |8|âˆ’|3| = 5,  í° ìª½(8)ì´ ì–‘ìˆ˜ â†’ ë‹µ: 5'
  },
  int_medium:{
    title:'ì •ìˆ˜ì˜ ê³±ì…ˆ Â· ë‚˜ëˆ—ì…ˆ Â· ì—°ì‚° ìˆœì„œ',
    rules:[
      '(+)Ã—(+)=(+),  (âˆ’)Ã—(âˆ’)=(+)',
      '(+)Ã—(âˆ’)=(âˆ’),  (âˆ’)Ã—(+)=(âˆ’)',
      'ë‚˜ëˆ—ì…ˆ ë¶€í˜¸ ê·œì¹™ë„ ë™ì¼',
      'ì—°ì‚° ìˆœì„œ: Ã—, Ã· ë¨¼ì € â†’ ê·¸ ë‹¤ìŒ +, âˆ’'
    ],
    ex:'2 + (-3) Ã— 4 = ?  â†’  (-3)Ã—4=-12 ë¨¼ì €,  2+(-12)=-10'
  },
  int_hard:{
    title:'ë³µí•© ì—°ì‚° (ì‚¬ì¹™ì—°ì‚° Â· ê´„í˜¸)',
    rules:[
      'â‘  ì†Œê´„í˜¸() â†’ ì¤‘ê´„í˜¸{} â†’ ëŒ€ê´„í˜¸[] ìˆœì„œ',
      'â‘¡ ê´„í˜¸ ì—†ìœ¼ë©´: Ã— Ã· ë¨¼ì €',
      'â‘¢ ê°™ì€ ìš°ì„ ìˆœìœ„: ì™¼ìª½ë¶€í„°',
      'â‘£ ë§ˆì§€ë§‰ + âˆ’',
      'ê°€ê°ìŠ¹ì œ 2~4ê°œ í˜¼í•© ë¬¸ì œ í¬í•¨!'
    ],
    ex:'3 + 2Ã—(âˆ’4) âˆ’ 6Ã·(âˆ’2) = 3 + (âˆ’8) âˆ’ (âˆ’3) = âˆ’2'
  },
  rat_easy:{
    title:'ìœ ë¦¬ìˆ˜ì˜ ë§ì…ˆ Â· ëº„ì…ˆ (ê°™ì€ ë¶„ëª¨)',
    rules:[
      'ë¶„ëª¨ê°€ ê°™ìœ¼ë©´ â†’ ë¶„ìë§Œ ê³„ì‚°, ë¶„ëª¨ ê·¸ëŒ€ë¡œ',
      'ê²°ê³¼ëŠ” í•­ìƒ ì•½ë¶„(ê¸°ì•½ë¶„ìˆ˜)ìœ¼ë¡œ',
      'ìŒìˆ˜ ë¶„ì ê°€ëŠ¥ â†’ ë¶€í˜¸ ì£¼ì˜'
    ],
    ex:'2/5 + 1/5 = 3/5  /  3/4 âˆ’ 1/4 = 2/4 = 1/2'
  },
  rat_medium:{
    title:'ìœ ë¦¬ìˆ˜ì˜ ì—°ì‚° (ë‹¤ë¥¸ ë¶„ëª¨ Â· ê³±ì…ˆ)',
    rules:[
      'ë‹¤ë¥¸ ë¶„ëª¨ ë§ì…ˆ: ìµœì†Œê³µë°°ìˆ˜(LCM)ë¡œ í†µë¶„ í›„ ê³„ì‚°',
      'ê³±ì…ˆ: ë¶„ìÃ—ë¶„ì, ë¶„ëª¨Ã—ë¶„ëª¨',
      'ê²°ê³¼ëŠ” í•­ìƒ ì•½ë¶„'
    ],
    ex:'1/3 + 1/4: LCM=12 â†’ 4/12+3/12=7/12'
  },
  rat_hard:{
    title:'ìœ ë¦¬ìˆ˜ ë³µí•© ì—°ì‚° (ë‚˜ëˆ—ì…ˆ Â· í˜¼í•©)',
    rules:[
      'a/b Ã· c/d = a/b Ã— d/c  (ì—­ìˆ˜ë¥¼ ê³±í•¨)',
      'ë¶„ìˆ˜ë„ ì—°ì‚° ìˆœì„œ ë™ì¼: Ã— Ã· ë¨¼ì €!',
      'í˜¼í•©: Ã— ê³„ì‚° í›„ í†µë¶„í•˜ì—¬ + âˆ’ ê³„ì‚°',
      'ìµœì¢… ê²°ê³¼ ë°˜ë“œì‹œ ì•½ë¶„!'
    ],
    ex:'1/2 + 1/3 Ã— 3/4 = 1/2 + 1/4 = 3/4'
  }
};

const TIPS = {
  int_easy:'ğŸ’¡ ë¶€í˜¸ê°€ ê°™ìœ¼ë©´ ì ˆëŒ“ê°’ í•©, ë‹¤ë¥´ë©´ ì ˆëŒ“ê°’ ì°¨  /  ëº„ì…ˆì€ ë”í•˜ê¸°ë¡œ ë³€í™˜',
  int_medium:'ğŸ’¡ ê³±ì…ˆÂ·ë‚˜ëˆ—ì…ˆ: ê°™ì€ ë¶€í˜¸=ì–‘ìˆ˜, ë‹¤ë¥¸ ë¶€í˜¸=ìŒìˆ˜  /  Ã— Ã· ë¨¼ì € ê³„ì‚°',
  int_hard:'ğŸ’¡ ìˆœì„œ: â‘  ê´„í˜¸(){}[] â‘¡ Ã— Ã· â‘¢ + âˆ’  /  ê°€ê°ìŠ¹ì œ í˜¼í•©: Ã— Ã· ëª¨ë‘ ê³„ì‚° í›„ + âˆ’',
  rat_easy:'ğŸ’¡ ë¶„ëª¨ê°€ ê°™ìœ¼ë©´ ë¶„ìë¼ë¦¬ë§Œ ê³„ì‚° â†’ ì•½ë¶„ í™•ì¸',
  rat_medium:'ğŸ’¡ ë‹¤ë¥¸ ë¶„ëª¨: LCMìœ¼ë¡œ í†µë¶„  /  ê³±ì…ˆ: ë¶„ìÃ—ë¶„ì, ë¶„ëª¨Ã—ë¶„ëª¨',
  rat_hard:'ğŸ’¡ ë‚˜ëˆ—ì…ˆ: ì—­ìˆ˜ ê³±í•˜ê¸°  /  í˜¼í•© ì—°ì‚°: Ã— Ã· ë¨¼ì € ê³„ì‚° â†’ í†µë¶„ â†’ + âˆ’  /  ê²°ê³¼ í•­ìƒ ì•½ë¶„!'
};

// â”€â”€ ì •ìˆ˜ ë¬¸ì œ ìƒì„± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function genInt(diff){
  let question, answer, steps=[];

  if(diff==='easy'){
    const a=ri(-20,20), b=ri(-20,20), op=Math.random()<.5?'+':'-';
    answer = op==='+'?a+b:a-b;
    question = `${wrap(a)} ${op} ${wrap(b)} = ?`;
    if(op==='+'){
      if(a>=0&&b>=0){
        steps=['ë‘ ì–‘ìˆ˜(+)ì˜ í•©',`${a} + ${b} = <strong>${answer}</strong>`];
      }else if(a<0&&b<0){
        steps=[
          'ë‘ ìŒìˆ˜(âˆ’)ì˜ í•©: ì ˆëŒ“ê°’ì„ ë”í•˜ê³  ìŒìˆ˜(-) ë¶€í˜¸',
          `|${a}| + |${b}| = ${Math.abs(a)} + ${Math.abs(b)} = ${Math.abs(a)+Math.abs(b)}`,
          `ë‘ ìŒìˆ˜ì´ë¯€ë¡œ â†’ <strong>${answer}</strong>`
        ];
      }else{
        const big=Math.abs(a)>=Math.abs(b)?a:b;
        const small=Math.abs(a)<Math.abs(b)?a:b;
        steps=[
          'ë¶€í˜¸ê°€ ë‹¤ë¥¸ ë‘ ìˆ˜ì˜ í•© â†’ ì ˆëŒ“ê°’ì˜ ì°¨, í° ìª½ ë¶€í˜¸',
          `ì ˆëŒ“ê°’ì˜ ì°¨: ${Math.abs(big)} âˆ’ ${Math.abs(small)} = ${Math.abs(big)-Math.abs(small)}`,
          `ì ˆëŒ“ê°’ì´ í° ìˆ˜(${Math.abs(big)})ëŠ” ${big>0?'ì–‘ìˆ˜(+)':'ìŒìˆ˜(âˆ’)'}`,
          `ì •ë‹µ: <strong>${answer}</strong>`
        ];
      }
    }else{
      const b2=-b;
      steps=['ëº„ì…ˆ â†’ ë§ì…ˆìœ¼ë¡œ ë³€í™˜: a âˆ’ b = a + (âˆ’b)',
             `${wrap(a)} âˆ’ ${wrap(b)} = ${wrap(a)} + (${b2})`];
      if(a>=0&&b2>=0) steps.push(`ë‘ ì–‘ìˆ˜ì˜ í•©: ${a} + ${b2} = <strong>${answer}</strong>`);
      else if(a<0&&b2<0) steps.push(`ë‘ ìŒìˆ˜ì˜ í•©: âˆ’(${Math.abs(a)}+${Math.abs(b2)}) = <strong>${answer}</strong>`);
      else{
        const big=Math.abs(a)>=Math.abs(b2)?a:b2;
        const small=Math.abs(a)<Math.abs(b2)?a:b2;
        steps.push(`ì ˆëŒ“ê°’ì˜ ì°¨: ${Math.abs(big)} âˆ’ ${Math.abs(small)} = ${Math.abs(big)-Math.abs(small)}`);
        steps.push(`í° ìª½(${big>0?'ì–‘ìˆ˜':'ìŒìˆ˜'}) ë¶€í˜¸ â†’ <strong>${answer}</strong>`);
      }
    }

  }else if(diff==='medium'){
    const t=ri(0,2);
    if(t===0){
      const a=rnz(-12,12),b=rnz(-12,12);
      answer=a*b; question=`${wrap(a)} Ã— ${wrap(b)} = ?`;
      const same=(a>0&&b>0)||(a<0&&b<0);
      steps=[
        'ê³±ì…ˆ ë¶€í˜¸ ê·œì¹™: ê°™ì€ ë¶€í˜¸ â†’ (+), ë‹¤ë¥¸ ë¶€í˜¸ â†’ (âˆ’)',
        `${a<0?'(âˆ’)':'(+)'} Ã— ${b<0?'(âˆ’)':'(+)'} = ${same?'<strong>(+)</strong>':'<strong>(âˆ’)</strong>'}`,
        `ì ˆëŒ“ê°’ ê³±: ${Math.abs(a)} Ã— ${Math.abs(b)} = ${Math.abs(a*b)}`,
        `ì •ë‹µ: <strong>${answer}</strong>`
      ];
    }else if(t===1){
      const b=rnz(-10,10),r=rnz(-10,10); const a=b*r;
      answer=r; question=`${wrap(a)} Ã· ${wrap(b)} = ?`;
      const same=(a>0&&b>0)||(a<0&&b<0);
      steps=[
        'ë‚˜ëˆ—ì…ˆ ë¶€í˜¸ ê·œì¹™: ê³±ì…ˆê³¼ ë™ì¼ (ê°™ì€ ë¶€í˜¸â†’ì–‘ìˆ˜, ë‹¤ë¥¸ ë¶€í˜¸â†’ìŒìˆ˜)',
        `${a<0?'(âˆ’)':'(+)'} Ã· ${b<0?'(âˆ’)':'(+)'} = ${same?'<strong>(+)</strong>':'<strong>(âˆ’)</strong>'}`,
        `ì ˆëŒ“ê°’ ë‚˜ëˆ—ì…ˆ: ${Math.abs(a)} Ã· ${Math.abs(b)} = ${Math.abs(r)}`,
        `ì •ë‹µ: <strong>${answer}</strong>`
      ];
    }else{
      const a=ri(-10,10),b=rnz(-6,6),c=rnz(-6,6);
      answer=a+b*c; question=`${wrap(a)} + ${wrap(b)} Ã— ${wrap(c)} = ?`;
      steps=[
        'ì—°ì‚° ìˆœì„œ: ê³±ì…ˆ(Ã—)ì„ ë§ì…ˆ(+)ë³´ë‹¤ ë¨¼ì €!',
        `â‘  ê³±ì…ˆ ë¨¼ì €: ${wrap(b)} Ã— ${wrap(c)} = <strong>${b*c}</strong>`,
        `â‘¡ ë§ì…ˆ: ${wrap(a)} + ${wrap(b*c)} = <strong>${answer}</strong>`
      ];
    }

  }else{
    const t=Math.floor(Math.random()*5);
    if(t===0){
      const a=ri(-10,10),b=ri(-10,10),c=rnz(-6,6);
      answer=(a+b)*c; question=`(${a} + ${wrap(b)}) Ã— ${wrap(c)} = ?`;
      steps=[
        'ì†Œê´„í˜¸ ì•ˆì„ ë¨¼ì € ê³„ì‚°!',
        `â‘  ì†Œê´„í˜¸(): ${a} + ${wrap(b)} = <strong>${a+b}</strong>`,
        `â‘¡ ê³±ì…ˆ: ${wrap(a+b)} Ã— ${wrap(c)} = <strong>${answer}</strong>`
      ];
    }else if(t===1){
      const a=rnz(-8,8),b=rnz(-8,8),c=ri(-10,10);
      answer=a*b-c; question=`${wrap(a)} Ã— ${wrap(b)} âˆ’ ${wrap(c)} = ?`;
      steps=[
        'ì—°ì‚° ìˆœì„œ: ê³±ì…ˆ(Ã—) ë¨¼ì €, ê·¸ ë‹¤ìŒ ëº„ì…ˆ',
        `â‘  ê³±ì…ˆ: ${wrap(a)} Ã— ${wrap(b)} = <strong>${a*b}</strong>`,
        `â‘¡ ëº„ì…ˆ: ${wrap(a*b)} âˆ’ ${wrap(c)} = <strong>${answer}</strong>`
      ];
    }else if(t===2){
      const x=ri(-4,4),b=ri(-6,6),a=ri(-6,6),c=rnz(-3,3);
      const inner=b-x, mid=a+inner;
      answer=c*mid;
      question=`${wrap(c)} Ã— [${a} + {${b} âˆ’ (${wrap(x)})}] = ?`;
      steps=[
        'ìˆœì„œ: ì†Œê´„í˜¸() â†’ ì¤‘ê´„í˜¸{} â†’ ëŒ€ê´„í˜¸[] â†’ ê³±ì…ˆ',
        `â‘  ì†Œê´„í˜¸(): ${wrap(x)} = ${x}`,
        `â‘¡ ì¤‘ê´„í˜¸{}: ${b} âˆ’ (${x}) = <strong>${inner}</strong>`,
        `â‘¢ ëŒ€ê´„í˜¸[]: ${a} + ${inner} = <strong>${mid}</strong>`,
        `â‘£ ê³±ì…ˆ: ${wrap(c)} Ã— ${mid} = <strong>${answer}</strong>`
      ];
    }else if(t===3){
      // ì‚¬ì¹™ 3ê°œ: a + bÃ—c âˆ’ d
      const a=ri(-10,10),b=rnz(-5,5),c=rnz(-5,5),d=ri(-8,8);
      const bc=b*c;
      answer=a+bc-d;
      question=`${wrap(a)} + ${wrap(b)} Ã— ${wrap(c)} âˆ’ ${wrap(d)} = ?`;
      steps=[
        'ê·œì¹™: Ã— Ã· ë¨¼ì €, ê·¸ ë‹¤ìŒ + âˆ’ (ì™¼â†’ì˜¤)!',
        `â‘  ê³±ì…ˆ ë¨¼ì €: ${wrap(b)} Ã— ${wrap(c)} = <strong>${bc}</strong>`,
        `â‘¡ ë§ì…ˆ: ${wrap(a)} + ${wrap(bc)} = <strong>${a+bc}</strong>`,
        `â‘¢ ëº„ì…ˆ: ${wrap(a+bc)} âˆ’ ${wrap(d)} = <strong>${answer}</strong>`
      ];
    }else{
      // ì‚¬ì¹™ 4ê°œ: aÃ—b + cÃ·d âˆ’ e  (ê°€ê°ìŠ¹ì œ ëª¨ë‘!)
      const dv=rnz(-4,4), cv=dv*rnz(-3,3);
      const a=rnz(-5,5), b=rnz(-5,5), e=ri(-8,8);
      const mult=a*b, div=cv/dv;
      answer=mult+div-e;
      question=`${wrap(a)} Ã— ${wrap(b)} + ${wrap(cv)} Ã· ${wrap(dv)} âˆ’ ${wrap(e)} = ?`;
      steps=[
        'ê°€ê°ìŠ¹ì œ ëª¨ë‘! ê·œì¹™: Ã— Ã· ë¨¼ì €, ì™¼ìª½ë¶€í„°',
        `â‘  ê³±ì…ˆ: ${wrap(a)} Ã— ${wrap(b)} = <strong>${mult}</strong>`,
        `â‘¡ ë‚˜ëˆ—ì…ˆ: ${wrap(cv)} Ã· ${wrap(dv)} = <strong>${div}</strong>`,
        `â‘¢ ë§ì…ˆ: ${mult} + ${div} = <strong>${mult+div}</strong>`,
        `â‘£ ëº„ì…ˆ: ${wrap(mult+div)} âˆ’ ${wrap(e)} = <strong>${answer}</strong>`
      ];
    }
  }

  steps.push(`âœ… ì •ë‹µ: <strong>${answer}</strong>`);
  const ws=new Set();
  while(ws.size<3){const d=rnz(-Math.max(8,Math.abs(answer||8)),Math.max(8,Math.abs(answer||8)));if(answer+d!==answer)ws.add(answer+d);}
  return{type:'int',question,answer:String(answer),choices:[String(answer),...[...ws].map(String)].sort(()=>Math.random()-.5),steps};
}

// â”€â”€ ìœ ë¦¬ìˆ˜ ë¬¸ì œ ìƒì„± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DENS=[2,3,4,5,6,8];
function genRat(diff){
  let question,ansF,steps=[];

  if(diff==='easy'){
    const d=DENS[ri(0,3)],n1=ri(1,d),n2=ri(1,d),op=Math.random()<.5?'+':'-';
    const rn=op==='+'?n1+n2:n1-n2;
    ansF=simp(rn,d);
    question=`${fh(n1,d)} ${op} ${fh(n2,d)} = ?`;
    steps=[
      `ë¶„ëª¨ê°€ ê°™ì•„ìš”(${d}) â†’ ë¶„ìë¼ë¦¬ë§Œ ê³„ì‚°, ë¶„ëª¨ëŠ” ê·¸ëŒ€ë¡œ!`,
      `ë¶„ì ê³„ì‚°: ${n1} ${op} ${n2} = <strong>${rn}</strong>`,
      `ê²°ê³¼: ${fh(rn,d)}`
    ];
    if(ansF.d!==d) steps.push(`ì•½ë¶„ (Ã·${gcd(Math.abs(rn),d)}): ${fh(rn,d)} = <strong>${fh(ansF.n,ansF.d)}</strong>`);
    else steps.push(`ì´ë¯¸ ê¸°ì•½ë¶„ìˆ˜: <strong>${fh(ansF.n,ansF.d)}</strong>`);

  }else if(diff==='medium'){
    if(Math.random()<.5){
      let d1=DENS[ri(0,4)],d2=DENS[ri(0,4)]; while(d2===d1)d2=DENS[ri(0,4)];
      const n1=ri(1,d1),n2=ri(1,d2),op=Math.random()<.5?'+':'-';
      const L=lcm(d1,d2),m1=L/d1,m2=L/d2;
      const rn=op==='+'?n1*m1+n2*m2:n1*m1-n2*m2;
      ansF=simp(rn,L);
      question=`${fh(n1,d1)} ${op} ${fh(n2,d2)} = ?`;
      steps=[
        `ë¶„ëª¨ê°€ ë‹¬ë¼ìš”(${d1}ê³¼ ${d2}) â†’ í†µë¶„ í•„ìš”!`,
        `ìµœì†Œê³µë°°ìˆ˜(LCM) = <strong>${L}</strong>`,
        `${fh(n1,d1)} = ${fh(n1*m1,L)} (ë¶„ìÂ·ë¶„ëª¨ì— ${m1} ê³±í•¨)`,
        `${fh(n2,d2)} = ${fh(n2*m2,L)} (ë¶„ìÂ·ë¶„ëª¨ì— ${m2} ê³±í•¨)`,
        `${fh(n1*m1,L)} ${op} ${fh(n2*m2,L)} = ${fh(rn,L)}`
      ];
      if(ansF.d!==L) steps.push(`ì•½ë¶„ (Ã·${gcd(Math.abs(rn),L)}): <strong>${fh(ansF.n,ansF.d)}</strong>`);
      else steps.push(`ê¸°ì•½ë¶„ìˆ˜: <strong>${fh(ansF.n,ansF.d)}</strong>`);
    }else{
      const d1=DENS[ri(0,4)],d2=DENS[ri(0,4)],n1=ri(1,d1),n2=ri(1,d2);
      ansF=simp(n1*n2,d1*d2);
      question=`${fh(n1,d1)} Ã— ${fh(n2,d2)} = ?`;
      steps=[
        'ë¶„ìˆ˜ ê³±ì…ˆ: ë¶„ìÃ—ë¶„ì, ë¶„ëª¨Ã—ë¶„ëª¨',
        `ë¶„ì: ${n1} Ã— ${n2} = <strong>${n1*n2}</strong>`,
        `ë¶„ëª¨: ${d1} Ã— ${d2} = <strong>${d1*d2}</strong>`,
        `ê²°ê³¼: ${fh(n1*n2,d1*d2)}`
      ];
      if(ansF.d!==d1*d2) steps.push(`ì•½ë¶„ (Ã·${gcd(n1*n2,d1*d2)}): <strong>${fh(ansF.n,ansF.d)}</strong>`);
      else steps.push(`ê¸°ì•½ë¶„ìˆ˜: <strong>${fh(ansF.n,ansF.d)}</strong>`);
    }
  }else{
    const rt=Math.floor(Math.random()*3);
    if(rt===0){
      // ê¸°ì¡´: ë‚˜ëˆ—ì…ˆ
      const d1=DENS[ri(0,5)],d2=DENS[ri(0,5)],n1=ri(1,d1),n2=ri(1,d2);
      ansF=simp(n1*d2,d1*n2);
      question=`${fh(n1,d1)} Ã· ${fh(n2,d2)} = ?`;
      steps=[
        'ë¶„ìˆ˜ ë‚˜ëˆ—ì…ˆ: ë’¤ ë¶„ìˆ˜ë¥¼ ë’¤ì§‘ì–´ì„œ ê³±í•˜ê¸°!',
        `${fh(n1,d1)} Ã· ${fh(n2,d2)} = ${fh(n1,d1)} Ã— ${fh(d2,n2)}`,
        `ë¶„ì: ${n1} Ã— ${d2} = <strong>${n1*d2}</strong>`,
        `ë¶„ëª¨: ${d1} Ã— ${n2} = <strong>${d1*n2}</strong>`,
        `ê²°ê³¼: ${fh(n1*d2,d1*n2)}`
      ];
      if(ansF.d!==d1*n2||ansF.n!==n1*d2) steps.push(`ì•½ë¶„ (Ã·${gcd(n1*d2,d1*n2)}): <strong>${fh(ansF.n,ansF.d)}</strong>`);
      else steps.push(`ê¸°ì•½ë¶„ìˆ˜: <strong>${fh(ansF.n,ansF.d)}</strong>`);
    }else if(rt===1){
      // ë¶„ìˆ˜ 3ê°œ: a/b + c/d Ã— e/f  (ê³±ì…ˆ ë¨¼ì €!)
      const d1=DENS[ri(0,3)],n1=ri(1,d1);
      const d2=DENS[ri(0,3)],n2=ri(1,d2);
      const d3=DENS[ri(0,3)],n3=ri(1,d3);
      const mN=n2*n3, mD=d2*d3;
      const mF=simp(mN,mD);
      const L=lcm(d1,mF.d);
      const rN=n1*(L/d1)+mF.n*(L/mF.d);
      ansF=simp(rN,L);
      question=`${fh(n1,d1)} + ${fh(n2,d2)} Ã— ${fh(n3,d3)} = ?`;
      steps=[
        'ë¶„ìˆ˜ë„ ì—°ì‚° ìˆœì„œ ë™ì¼! ê³±ì…ˆ(Ã—) ë¨¼ì €!',
        `â‘  ê³±ì…ˆ: ${fh(n2,d2)} Ã— ${fh(n3,d3)} = ${fh(mN,mD)} = <strong>${fh(mF.n,mF.d)}</strong>`,
        `â‘¡ í†µë¶„(LCM=${L}): ${fh(n1*(L/d1),L)} + ${fh(mF.n*(L/mF.d),L)} = ${fh(rN,L)}`,
        `â‘¢ ì•½ë¶„: <strong>${fh(ansF.n,ansF.d)}</strong>`
      ];
    }else{
      // ë¶„ìˆ˜ 3ê°œ: a/b Ã— c/d âˆ’ e/f  (ê³±ì…ˆ ë¨¼ì €, ë¹¼ê¸°)
      const d1=DENS[ri(0,3)],n1=ri(1,d1);
      const d2=DENS[ri(0,3)],n2=ri(1,d2);
      const d3=DENS[ri(0,3)],n3=ri(1,d3);
      const mN=n1*n2, mD=d1*d2;
      const mF=simp(mN,mD);
      const L=lcm(mF.d,d3);
      const rN=mF.n*(L/mF.d)-n3*(L/d3);
      ansF=simp(rN,L);
      question=`${fh(n1,d1)} Ã— ${fh(n2,d2)} âˆ’ ${fh(n3,d3)} = ?`;
      steps=[
        'ë¶„ìˆ˜ ê³±ì…ˆ(Ã—) ë¨¼ì €, ê·¸ ë‹¤ìŒ ëº„ì…ˆ(âˆ’)!',
        `â‘  ê³±ì…ˆ: ${fh(n1,d1)} Ã— ${fh(n2,d2)} = ${fh(mN,mD)} = <strong>${fh(mF.n,mF.d)}</strong>`,
        `â‘¡ í†µë¶„(LCM=${L}): ${fh(mF.n*(L/mF.d),L)} âˆ’ ${fh(n3*(L/d3),L)} = ${fh(rN,L)}`,
        `â‘¢ ì•½ë¶„: <strong>${fh(ansF.n,ansF.d)}</strong>`
      ];
    }
  }

  steps.push(`âœ… ì •ë‹µ: <strong>${fh(ansF.n,ansF.d)}</strong>`);
  const ca=fs(ansF),used=new Set([ca]),wrongs=[];
  const cands=[simp(ansF.n+1,ansF.d),simp(ansF.n-1,ansF.d),simp(ansF.n,ansF.d+1),simp(ansF.d,ansF.n||1),simp(ansF.n+2,ansF.d)];
  for(const w of cands){const s=fs(w);if(w.d>0&&!used.has(s)&&wrongs.length<3){used.add(s);wrongs.push(w);}}
  while(wrongs.length<3){const w=simp(ansF.n+rnz(-3,3),ansF.d+ri(0,2));const s=fs(w);if(w.d>0&&!used.has(s)){used.add(s);wrongs.push(w);}}
  return{type:'rat',question,answer:ca,choices:[ca,...wrongs.map(fs)].sort(()=>Math.random()-.5),steps};
}

// â”€â”€ ë©”ë‰´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function pickMode(m){
  S.mode=m;
  ['int','rat'].forEach(k=>document.getElementById('btn-'+k).classList.toggle('active',k===m));
  updateConceptPreview(); updateStartBtn();
}
function pickDiff(d){
  S.diff=d;
  ['easy','medium','hard'].forEach(k=>document.getElementById('btn-'+k).classList.toggle('active',k===d));
  updateConceptPreview(); updateStartBtn();
}
function updateStartBtn(){
  document.getElementById('start-btn').disabled=!(S.mode&&S.diff);
}
function updateConceptPreview(){
  const cp=document.getElementById('concept-preview');
  const cb=document.getElementById('concept-box');
  if(!S.mode||!S.diff){cp.classList.remove('show');return;}
  const key=S.mode+'_'+S.diff;
  const c=CONCEPTS[key];
  if(!c){cp.classList.remove('show');return;}
  cb.innerHTML=`<h4>ğŸ“ ${c.title}</h4><div class="rule">${c.rules.map(r=>`â€¢ ${r}`).join('<br>')}</div><div class="example">ğŸ’¡ ì˜ˆì‹œ: ${c.ex}</div>`;
  cp.classList.add('show');
}

// â”€â”€ ê²Œì„ ì‹œì‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startGame(){
  S.qs=Array.from({length:10},()=>S.mode==='int'?genInt(S.diff):genRat(S.diff));
  S.cur=0;S.score=0;S.correct=0;S.wrong=0;S.streak=0;S.mistakes=[];
  showScreen('scr-game');
  document.getElementById('tip-card').innerHTML=TIPS[S.mode+'_'+S.diff]||'';
  loadQ();
}
function retryGame(){ startGame(); }

// â”€â”€ ë¬¸ì œ ë¡œë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadQ(){
  const q=S.qs[S.cur];
  S.answered=false;
  document.getElementById('prog-label').textContent=`${S.cur+1} / 10`;
  document.getElementById('prog-fill').style.width=`${S.cur/10*100}%`;
  document.getElementById('score-badge').textContent=`â­ ${S.score}`;
  document.getElementById('prob-expr').innerHTML=q.question;
  document.getElementById('feedback').textContent='';
  document.getElementById('feedback').className='feedback';
  document.getElementById('hint-overlay').classList.remove('show');

  const sb=document.getElementById('streak-badge');
  if(S.streak>=2){sb.textContent=`ğŸ”¥ ${S.streak}ì—°ì†`;sb.classList.add('show');}
  else sb.classList.remove('show');

  const grid=document.getElementById('ans-grid');
  grid.innerHTML=q.choices.map((c,i)=>`
    <button class="ans-btn" id="ab${i}" onclick="checkAns(${i})">
      ${S.mode==='rat'?fhFromStr(c):c}
    </button>`).join('');

  clearInterval(S.timerID);
  S.tLeft=30; updTimer();
  S.timerID=setInterval(()=>{
    S.tLeft--; updTimer();
    if(S.tLeft<=0){clearInterval(S.timerID);timeUp();}
  },1000);
}

function fhFromStr(s){
  if(!s.includes('/')) return `<strong>${s}</strong>`;
  const [n,d]=s.split('/');
  return `<span class="frac"><span class="ft">${n}</span><span class="fb">${d}</span></span>`;
}

function updTimer(){
  const pct=S.tLeft/30*100;
  const f=document.getElementById('timer-fill');
  f.style.width=pct+'%';
  f.className='timer-fill'+(S.tLeft<=5?' danger':S.tLeft<=10?' warn':'');
  document.getElementById('timer-num').textContent=S.tLeft;
}

// â”€â”€ ì •ë‹µ í™•ì¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function checkAns(idx){
  if(S.answered)return;
  S.answered=true;
  clearInterval(S.timerID);
  const q=S.qs[S.cur];
  const ok=q.choices[idx]===q.answer;

  disableAnswers();
  if(ok){
    document.getElementById('ab'+idx).classList.add('correct');
    const bonus=Math.floor(S.tLeft/30*10);
    S.score+=10+bonus; S.correct++; S.streak++;
    const fb=document.getElementById('feedback');
    fb.className='feedback ok';
    fb.textContent=`âœ… ì •ë‹µ! +${10+bonus}ì ${bonus>0?' (ì‹œê°„ ë³´ë„ˆìŠ¤ +'+bonus+')':''}`;
    spawnParticles();
    setTimeout(()=>nextQ(),1400);
  }else{
    document.getElementById('ab'+idx).classList.add('wrong');
    S.wrong++; S.streak=0;
    S.mistakes.push({q:q.question.replace(/<[^>]+>/g,''),a:q.answer});
    const cbtn=q.choices.findIndex(c=>c===q.answer);
    if(cbtn>=0) document.getElementById('ab'+cbtn).classList.add('correct');
    const fb=document.getElementById('feedback');
    fb.className='feedback ng'; fb.textContent='âŒ í‹€ë ¸ì–´ìš”. í’€ì´ë¥¼ í™•ì¸í•´ë´ìš”!';
    showExplanation(q, false);
  }
}

function timeUp(){
  if(S.answered)return;
  S.answered=true;
  S.wrong++; S.streak=0;
  const q=S.qs[S.cur];
  S.mistakes.push({q:q.question.replace(/<[^>]+>/g,''),a:q.answer});
  disableAnswers();
  const cbtn=q.choices.findIndex(c=>c===q.answer);
  if(cbtn>=0) document.getElementById('ab'+cbtn).classList.add('correct');
  const fb=document.getElementById('feedback');
  fb.className='feedback ng'; fb.textContent='â° ì‹œê°„ ì´ˆê³¼!';
  showExplanation(q, true);
}

function disableAnswers(){
  for(let i=0;i<4;i++){const b=document.getElementById('ab'+i);if(b)b.disabled=true;}
}

// â”€â”€ í’€ì´ ëª¨ë‹¬ í‘œì‹œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showExplanation(q, isTimeUp){
  // í™”ë©´ í”Œë˜ì‹œ
  const flash=document.getElementById('flash-overlay');
  flash.className='flash-overlay';
  void flash.offsetWidth;
  flash.className='flash-overlay '+(isTimeUp?'orange':'red');

  // ë°°ë„ˆ í…ìŠ¤íŠ¸ & ì•„ì´ì½˜
  const titleEl=document.getElementById('wrong-title-text');
  const xEl=document.getElementById('wrong-x');
  titleEl.textContent=isTimeUp?'ì‹œê°„ ì´ˆê³¼!':'í‹€ë ¸ì–´ìš”!';
  xEl.textContent=isTimeUp?'â°':'âŒ';

  // ì• ë‹ˆë©”ì´ì…˜ ì¬ì‹œì‘ (display:noneâ†’flex ì „í™˜ìœ¼ë¡œ ìë™ ì¬ì‹œì‘ë˜ì§€ë§Œ ëª…ì‹œì ìœ¼ë¡œ ì´ˆê¸°í™”)
  [xEl, titleEl].forEach(el=>{
    el.style.animation='none';
    void el.offsetWidth;
    el.style.animation='';
  });

  // ë‹¨ê³„ë³„ í’€ì´ (stagger delay)
  const list=document.getElementById('explain-steps');
  list.innerHTML=q.steps.map((s,i)=>{
    const isLast=i===q.steps.length-1;
    const delay=`${i*140+100}ms`;
    return `<li class="${isLast?'highlight':''}" style="animation-delay:${delay}">
      <span class="step-num ${isLast?'final':''}">${isLast?'âœ…':`${i+1}.`}</span> ${s}
    </li>`;
  }).join('');

  document.getElementById('explain-overlay').classList.add('show');
  window.scrollTo(0,0);
}

function nextQ(){
  document.getElementById('explain-overlay').classList.remove('show');
  S.cur++;
  if(S.cur>=10) showResult();
  else loadQ();
}

// â”€â”€ íŒŒí‹°í´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function spawnParticles(){
  const emojis=['â­','âœ¨','ğŸ’«','ğŸ‰','ğŸŒŸ','ğŸ’¥'];
  for(let i=0;i<10;i++){
    const p=document.createElement('div');
    p.className='particle';
    p.textContent=emojis[ri(0,5)];
    p.style.left=ri(5,95)+'%';
    p.style.top=ri(15,75)+'%';
    p.style.animationDelay=(i*55)+'ms';
    p.style.fontSize=ri(14,28)+'px';
    document.body.appendChild(p);
    setTimeout(()=>p.remove(),950);
  }
}

// â”€â”€ ê²°ê³¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showResult(){
  clearInterval(S.timerID);
  showScreen('scr-result');
  const acc=Math.round(S.correct/10*100);
  let emoji,msg;
  if(acc>=90){emoji='ğŸ†';msg='ì™„ë²½í•´! ìˆ˜í•™ ì²œì¬ ì¸ì •!';}
  else if(acc>=70){emoji='â­';msg='í›Œë¥­í•´! ì¡°ê¸ˆë§Œ ë” ì—°ìŠµí•˜ë©´ ì™„ë²½!';}
  else if(acc>=50){emoji='ğŸ‘';msg='ì˜í–ˆì–´! ì˜¤ë‹µ ë…¸íŠ¸ë¡œ ë¶€ì¡±í•œ ë¶€ë¶„ ë³µìŠµí•´ë´!';}
  else{emoji='ğŸ’ª';msg='ê´œì°®ì•„! ê°œë…ì„ ë‹¤ì‹œ ì½ê³  ë„ì „í•´ë´!';}
  document.getElementById('res-emoji').textContent=emoji;
  document.getElementById('res-score').textContent=S.score;
  document.getElementById('res-msg').textContent=msg;
  document.getElementById('res-correct').textContent=S.correct;
  document.getElementById('res-wrong').textContent=S.wrong;
  document.getElementById('res-acc').textContent=acc+'%';

  const ms=document.getElementById('mistake-section');
  const ml=document.getElementById('mistake-list');
  if(S.mistakes.length>0){
    ms.style.display='block';
    ml.innerHTML=S.mistakes.map(m=>`
      <div class="mistake-item">
        <div class="mq">ë¬¸ì œ: ${m.q}</div>
        <div class="ma">ì •ë‹µ: <strong>${m.a}</strong></div>
      </div>`).join('');
  }else{
    ms.style.display='none';
  }
}

// â”€â”€ íŒíŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showHint(){
  const key=S.mode+'_'+S.diff;
  const concept=CONCEPTS[key];
  const tip=TIPS[key]||'';

  // íŒ í…ìŠ¤íŠ¸ (ğŸ’¡ ì´ëª¨ì§€ ì œê±°í•˜ê³  í‘œì‹œ)
  document.getElementById('hint-tip').textContent=tip.replace(/^ğŸ’¡\s*/,'');

  // ê°œë… ê·œì¹™ ëª©ë¡ (stagger ë”œë ˆì´)
  const ul=document.getElementById('hint-rules');
  ul.innerHTML=(concept?concept.rules:[]).map((r,i)=>
    `<li style="animation-delay:${i*110+80}ms">â€¢ ${r}</li>`
  ).join('');

  document.getElementById('hint-overlay').classList.add('show');
  window.scrollTo(0,0);
}
function closeHint(){
  document.getElementById('hint-overlay').classList.remove('show');
}

function goMenu(){ showScreen('scr-menu'); }
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo(0,0);
}
</script>
<!-- PWA Service Worker ë“±ë¡ -->
<script>
if('serviceWorker' in navigator){
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js')
      .then(()=> console.log('SW ë“±ë¡ ì™„ë£Œ'))
      .catch(e => console.log('SW ë“±ë¡ ì‹¤íŒ¨:', e));
  });
}
</script>
</body>
</html>
